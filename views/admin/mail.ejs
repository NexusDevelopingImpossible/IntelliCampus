<link rel="stylesheet" href="<%= assetPath('css/mail.css') %>" />

<div class="main-page">
  <div class="blur">
    <div class="page-heading">
      <a href="/admin/dashboard"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -960 960 960">
          <path
            d="M381-100 44-436q-9-9-13.5-20.5T26-480q0-12 4.5-23.5T44-524l337-337q21-21 51-21.5t52 21.5q21 21 21 51.5T484-758L206-480l278 278q21 21 21.5 50.5T484-100q-21 21-51.5 21T381-100Z" />
        </svg></a>
      <h1 class="heading">Mails</h1>
  </div>


   

    <div class="main__content">
    
      <div class="sent__mails__button">
        <h3></h3>
        <button class="compose__btn btn btn-full" id="compose__btn">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="1.5vw" fill="#FFFFFF"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M3 17.46v3.04c0 .28.22.5.5.5h3.04c.13 0 .26-.05.35-.15L17.81 9.94l-3.75-3.75L3.15 17.1c-.1.1-.15.22-.15.36zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
          <span>Compose</span>
        </button>
      </div>

      <div class="mail__list">
       <%for(let i = 0; i<maillist.length; i++){%> 
        <div class="mail">
          <div>
          <div class="mail__icon">
            <svg
              width="50"
              height="16"
              viewBox="0 0 36 28"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M30 0.5H6C2.7 0.5 0 3.2 0 6.5V21.5C0 24.8 2.7 27.5 6 27.5H30C33.3 27.5 36 24.8 36 21.5V6.5C36 3.2 33.3 0.5 30 0.5ZM32.4 9.2L20.55 17.15C19.8 17.6 18.9 17.9 18 17.9C17.1 17.9 16.2 17.6 15.45 17.15L3.6 9.2C3 8.75 2.85 7.85 3.3 7.1C3.75 6.5 4.65 6.35 5.4 6.8L17.25 14.75C17.7 15.05 18.45 15.05 18.9 14.75L30.75 6.8C31.5 6.35 32.4 6.5 32.85 7.25C33.15 7.85 33 8.75 32.4 9.2Z"
                fill="white"
              />
            </svg>
          </div>
          <p class="mail__description">
            <span class="mail__title"><%=maillist[i].department%> - <%=maillist[i].semester%>(<%=maillist[i].section%>)</span> <span class="dot-sep"></span><span class="sub-glmp"><%=maillist[i].subject%>
              </span>
          </p>
        </div>
        <span class="desc-glmp"><%=maillist[i].description%></span>
        <div class="end-pt">
          <div class="time"></div>
        </div>
        </div>
      <%}%>
       
      

      </div>
    </div>
  </div>
  <div class="popup pp">
  </div>
  <div class="modal pp" id="modal">
    <div class="top">
      <h3>Compose Mail</h3>
      <button class="close" id="close">
        <svg
          width="30"
          height="30"
          viewBox="0 0 58 58"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <g clip-path="url(#clip0_1546_5783)">
            <path
              d="M38.4546 19.13C43.8882 24.351 44.0612 33.0201 38.8403 38.4538C33.6193 43.8874 24.9502 44.0604 19.5165 38.8395C14.0829 33.6185 13.9098 24.9494 19.1308 19.5157C24.3518 14.0821 33.0209 13.9091 38.4546 19.13ZM40.8218 16.6664C34.0184 10.1292 23.2043 10.345 16.6671 17.1485C10.13 23.9519 10.3458 34.766 17.1493 41.3031C23.9527 47.8403 34.7668 47.6245 41.3039 40.821C47.8411 34.0176 47.6253 23.2035 40.8218 16.6664ZM36.3284 33.671L31.401 28.9365L36.1355 24.0092L33.6718 21.6419L28.9373 26.5693L24.01 21.8348L21.6427 24.2985L26.5701 29.033L21.8356 33.9603L24.2992 36.3276L29.0338 31.4002L33.9611 36.1347L36.3284 33.671Z"
              fill="white"
            />
          </g>
          <defs>
            <clipPath id="clip0_1546_5783">
              <rect
                width="41"
                height="41"
                fill="white"
                transform="translate(28.4072) rotate(43.8565)"
              />
            </clipPath>
          </defs>
        </svg>
      </button>
    </div>
    <form action="/admin/mail/send" method="post">
    <div class="middle">
      <!-- DropDown Section -->
      <div class="dropdown__section">To :<select id="department" name="department" class="filter-select">
          <option value="" disabled selected>Department</option>
      </select>
      <select id="course" class="filter-select" name="course">
          <option value="" disabled selected>Course</option>
          
      </select>
  
  
      <select id="semester" class="filter-select" name="semester">
          <option value="" disabled selected>Semester</option>
          
      </select>
  

      <select id="section" class="filter-select" name="section">
          <option value="" disabled selected>Section</option>
          
      </select></div>
      <div class="subject__title">
        <span>Subject : </span>
        <input type="text" name="subject" id="" />
      </div>
      <div class="description-text">
        <span>Description : </span>
        <textarea name="description" class="mail__content" id="" cols="30" rows="10"> </textarea>
      </div>
    </div>
    <div class="bottom">
      <!-- <div class="row2">
        <button class="btna">
          Attach a File
          <span>
            <svg
              width="20"
              height="20"
              viewBox="0 0 35 35"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M26.7806 9.67586C24.5042 7.40232 20.8014 7.40232 18.5294 9.67586L11.9173 16.2894C11.2275 16.9792 10.8483 17.8936 10.8483 18.8706C10.8483 19.8448 11.2289 20.7592 11.9158 21.449C12.626 22.1577 13.5608 22.5136 14.4956 22.5136C15.4289 22.5136 16.3608 22.1607 17.0725 21.449L20.1671 18.3559C20.7373 17.7798 21.0217 17.0375 21.0217 16.2938C21.0217 15.5471 20.7373 14.8019 20.1671 14.2317L15.0104 19.3869C14.7289 19.6713 14.2652 19.6713 13.9779 19.384C13.7927 19.1988 13.765 18.9829 13.765 18.8706C13.765 18.7569 13.7927 18.5396 13.9779 18.3544L20.5914 11.7379C21.726 10.6019 23.5781 10.6019 24.7185 11.7379C25.8546 12.874 25.8546 14.7261 24.7185 15.8621L18.1021 22.4786L14.4052 26.1754C13.2692 27.3115 11.4171 27.3115 10.281 26.1754C9.14353 25.0394 9.14353 23.1873 10.281 22.0513L10.4196 21.9113C9.76186 21.0363 9.39582 19.9294 9.39582 18.8123L8.21895 19.9892C5.94395 22.2627 5.94395 25.9654 8.21895 28.2375C9.35499 29.3736 10.8498 29.9438 12.3431 29.9438C13.8364 29.9438 15.3312 29.3736 16.4673 28.2375L26.7806 17.9242C29.0556 15.6507 29.0556 11.9509 26.7806 9.67586Z"
                fill="white"
              />
            </svg>
          </span>
        </button>
        <input type="file" name="myfile" /> -->
        <button class="send__btn btn btn-full btn-medium">Send</button>
      <!-- </div> -->
    </div>
    </form>
  </div>
</div>

<script src="<%= assetPath('js/mail.js') %>"></script>
<script>
    let v = <%- JSON.stringify(locals.semsec) %>;
    const data = v;
    const departmentSelect = document.getElementById("department");
        const courseSelect = document.getElementById("course");
        const semesterSelect = document.getElementById("semester");
        const sectionSelect = document.getElementById("section");

        // Function to populate select options
        function populateOptions(selectElement, options) {
            selectElement.innerHTML = '';
            options.forEach(option => {
                const { value, text } = option;
                const optionElement = document.createElement("option");
                optionElement.value = value;
                optionElement.textContent = text;
                selectElement.appendChild(optionElement);
            });
        }

        // Function to filter unique values from an array of objects
        function getUniqueValues(array, key) {
            return [...new Set(array.map(item => item[key]))];
        }

        // Function to filter data based on selected filters
        function filterData() {
            const selectedDepartment = departmentSelect.value;
            const selectedCourse = courseSelect.value;
            const selectedSemester = semesterSelect.value;

            // Filter the data based on the selected filters
            const filteredData = data.filter(item => {
                return (
                    (selectedDepartment === '' || item.department === selectedDepartment) &&
                    (selectedCourse === '' || item.course === selectedCourse) &&
                    (selectedSemester === '' || item.semester.toString() === selectedSemester) // Compare as strings
                );
            });

            // Populate semester options based on the filtered data
            const semesters = getUniqueValues(filteredData, 'semester');
            const semesterOptions = semesters.map(semester => ({ value: semester, text: `${semester}` }));
            populateOptions(semesterSelect, [{ value: '', text: 'Semester' }, ...semesterOptions]);

            // When semester changes, update the section options as well
            filterSections();
        }

        // Function to filter section options based on the selected filters
        function filterSections() {
            const selectedDepartment = departmentSelect.value;
            const selectedCourse = courseSelect.value;
            const selectedSemester = semesterSelect.value;

            // Filter the data based on the selected filters
            const filteredData = data.filter(item => {
                return (
                    (selectedDepartment === '' || item.department === selectedDepartment) &&
                    (selectedCourse === '' || item.course === selectedCourse) &&
                    (selectedSemester === '' || item.semester.toString() === selectedSemester) // Compare as strings
                );
            });

            // Populate section options based on the filtered data
            const sections = getUniqueValues(filteredData, 'section');
            const sectionOptions = sections.map(section => ({ value: section, text: `${section}` }));
            populateOptions(sectionSelect, [{ value: '', text: 'Section' }, ...sectionOptions]);
        }

        // Event listeners for select elements
        departmentSelect.addEventListener("change", filterData);
        courseSelect.addEventListener("change", filterData);
        semesterSelect.addEventListener("change", filterSections); // Update sections when semester changes

        // Populate initial options for department and course selects
        const departments = getUniqueValues(data, 'department');
        const departmentOptions = departments.map(department => ({ value: department, text: department }));
        populateOptions(departmentSelect, [{ value: '', text: 'Department' }, ...departmentOptions]);

        const courses = getUniqueValues(data, 'course');
        const courseOptions = courses.map(course => ({ value: course, text: course }));
        populateOptions(courseSelect, [{ value: '', text: 'Course' }, ...courseOptions]);
</script>